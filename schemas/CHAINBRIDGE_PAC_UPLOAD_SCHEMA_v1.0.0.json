{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://chainbridge.io/schemas/CHAINBRIDGE_PAC_UPLOAD_SCHEMA_v1.0.0.json",
  "title": "ChainBridge PAC Upload Schema",
  "description": "Authoritative schema for PAC (Proof of Agent Compliance) upload validation. All PAC submissions MUST conform to this schema for OCC intake. Non-conformant submissions are mechanically rejected with enumerated codes.",
  "version": "1.0.0",
  "type": "object",
  "required": [
    "pac_id",
    "pac_version",
    "classification",
    "governance_tier",
    "schema_version",
    "issuer_gid",
    "issuer_role",
    "issued_at",
    "scope",
    "drift_tolerance",
    "fail_closed",
    "blocks",
    "hash"
  ],
  "properties": {
    "pac_id": {
      "type": "string",
      "pattern": "^PAC-[A-Z]+-[A-Z][0-9]{2}$",
      "description": "Unique PAC identifier. Format: PAC-{ISSUER}-{TYPE}{SEQ}. Example: PAC-JEFFREY-P03, PAC-BENSON-C01"
    },
    "pac_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+$",
      "description": "PAC version number. Format: MAJOR.MINOR"
    },
    "classification": {
      "type": "string",
      "enum": ["PROACTIVE", "CORRECTIVE", "EMERGENCY"],
      "description": "PAC classification type. PROACTIVE: new capability. CORRECTIVE: fix/remediation. EMERGENCY: critical response."
    },
    "governance_tier": {
      "type": "string",
      "enum": ["LAW", "POLICY", "OPERATIONAL"],
      "description": "Constitutional governance tier. LAW: immutable foundation. POLICY: configurable rules. OPERATIONAL: runtime parameters."
    },
    "schema_version": {
      "type": "string",
      "const": "CHAINBRIDGE_PAC_SCHEMA_v1.0.0",
      "description": "Schema version this PAC conforms to. Must be exact match."
    },
    "issuer_gid": {
      "type": "string",
      "description": "Governance ID of the issuing agent. Example: JEFFREY, BENSON, GID-00"
    },
    "issuer_role": {
      "type": "string",
      "description": "Role of the issuing agent. Example: CONSTITUTIONAL ARCHITECT, ORCHESTRATOR"
    },
    "issued_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when PAC was issued"
    },
    "scope": {
      "type": "string",
      "minLength": 10,
      "maxLength": 500,
      "description": "Clear description of PAC scope and intent"
    },
    "supersedes": {
      "type": ["string", "null"],
      "description": "PAC ID this supersedes (for CORRECTIVE PACs). Null if not applicable."
    },
    "drift_tolerance": {
      "type": "string",
      "enum": ["ZERO", "LOW", "MEDIUM"],
      "description": "Allowed deviation from PAC specification. ZERO: exact compliance required."
    },
    "fail_closed": {
      "type": "boolean",
      "const": true,
      "description": "Fail-closed enforcement. Must always be true."
    },
    "blocks": {
      "type": "array",
      "minItems": 20,
      "maxItems": 20,
      "description": "Exactly 20 blocks required per CHAINBRIDGE_PAC_SCHEMA_v1.0.0",
      "items": {
        "$ref": "#/definitions/block"
      }
    },
    "hash": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA-256 hash of canonical PAC content for integrity verification"
    }
  },
  "definitions": {
    "block": {
      "type": "object",
      "required": ["index", "type", "content"],
      "properties": {
        "index": {
          "type": "integer",
          "minimum": 0,
          "maximum": 19,
          "description": "Block index (0-19). Must be sequential with no gaps or duplicates."
        },
        "type": {
          "type": "string",
          "enum": [
            "METADATA",
            "PAC_ADMISSION",
            "RUNTIME_ACTIVATION",
            "RUNTIME_ACKNOWLEDGEMENT",
            "RUNTIME_ACK_COLLECTION",
            "AGENT_ACTIVATION",
            "AGENT_ACKNOWLEDGEMENT",
            "AGENT_ACK_COLLECTION",
            "EXECUTION_LANE",
            "CONTEXT",
            "GOAL_STATE",
            "CONSTRAINTS_GUARDRAILS",
            "INVARIANTS_ENFORCED",
            "TASKS_PLAN",
            "FILE_CODE_TARGETS",
            "INTERFACES_CONTRACTS",
            "TESTING_VERIFICATION",
            "WRAP_TRAINING_SIGNAL",
            "POSITIVE_CLOSURE",
            "LEDGER_COMMIT"
          ],
          "description": "Block type. Must match index position per schema specification."
        },
        "content": {
          "type": "object",
          "description": "Block-specific content. Schema varies by block type."
        }
      },
      "allOf": [
        {
          "if": { "properties": { "index": { "const": 0 } } },
          "then": { "properties": { "type": { "const": "METADATA" } } }
        },
        {
          "if": { "properties": { "index": { "const": 1 } } },
          "then": { "properties": { "type": { "const": "PAC_ADMISSION" } } }
        },
        {
          "if": { "properties": { "index": { "const": 2 } } },
          "then": { "properties": { "type": { "const": "RUNTIME_ACTIVATION" } } }
        },
        {
          "if": { "properties": { "index": { "const": 3 } } },
          "then": { "properties": { "type": { "const": "RUNTIME_ACKNOWLEDGEMENT" } } }
        },
        {
          "if": { "properties": { "index": { "const": 4 } } },
          "then": { "properties": { "type": { "const": "RUNTIME_ACK_COLLECTION" } } }
        },
        {
          "if": { "properties": { "index": { "const": 5 } } },
          "then": { "properties": { "type": { "const": "AGENT_ACTIVATION" } } }
        },
        {
          "if": { "properties": { "index": { "const": 6 } } },
          "then": { "properties": { "type": { "const": "AGENT_ACKNOWLEDGEMENT" } } }
        },
        {
          "if": { "properties": { "index": { "const": 7 } } },
          "then": { "properties": { "type": { "const": "AGENT_ACK_COLLECTION" } } }
        },
        {
          "if": { "properties": { "index": { "const": 8 } } },
          "then": { "properties": { "type": { "const": "EXECUTION_LANE" } } }
        },
        {
          "if": { "properties": { "index": { "const": 9 } } },
          "then": { "properties": { "type": { "const": "CONTEXT" } } }
        },
        {
          "if": { "properties": { "index": { "const": 10 } } },
          "then": { "properties": { "type": { "const": "GOAL_STATE" } } }
        },
        {
          "if": { "properties": { "index": { "const": 11 } } },
          "then": { "properties": { "type": { "const": "CONSTRAINTS_GUARDRAILS" } } }
        },
        {
          "if": { "properties": { "index": { "const": 12 } } },
          "then": { "properties": { "type": { "const": "INVARIANTS_ENFORCED" } } }
        },
        {
          "if": { "properties": { "index": { "const": 13 } } },
          "then": { "properties": { "type": { "const": "TASKS_PLAN" } } }
        },
        {
          "if": { "properties": { "index": { "const": 14 } } },
          "then": { "properties": { "type": { "const": "FILE_CODE_TARGETS" } } }
        },
        {
          "if": { "properties": { "index": { "const": 15 } } },
          "then": { "properties": { "type": { "const": "INTERFACES_CONTRACTS" } } }
        },
        {
          "if": { "properties": { "index": { "const": 16 } } },
          "then": { "properties": { "type": { "const": "TESTING_VERIFICATION" } } }
        },
        {
          "if": { "properties": { "index": { "const": 17 } } },
          "then": { "properties": { "type": { "const": "WRAP_TRAINING_SIGNAL" } } }
        },
        {
          "if": { "properties": { "index": { "const": 18 } } },
          "then": { "properties": { "type": { "const": "POSITIVE_CLOSURE" } } }
        },
        {
          "if": { "properties": { "index": { "const": 19 } } },
          "then": { "properties": { "type": { "const": "LEDGER_COMMIT" } } }
        }
      ]
    },
    "block_content_metadata": {
      "type": "object",
      "required": ["pac_id", "pac_version", "classification", "governance_tier"],
      "properties": {
        "pac_id": { "type": "string" },
        "pac_version": { "type": "string" },
        "classification": { "type": "string" },
        "governance_tier": { "type": "string" },
        "issuer_gid": { "type": "string" },
        "issuer_role": { "type": "string" },
        "issued_at": { "type": "string", "format": "date-time" },
        "scope": { "type": "string" },
        "supersedes": { "type": ["string", "null"] },
        "drift_tolerance": { "type": "string" },
        "fail_closed": { "type": "boolean" },
        "schema_version": { "type": "string" }
      }
    },
    "block_content_pac_admission": {
      "type": "object",
      "required": ["authority", "admission"],
      "properties": {
        "authority": {
          "type": "string",
          "enum": ["VALID", "INVALID"],
          "description": "Authority validation result"
        },
        "admission": {
          "type": "string",
          "enum": ["GRANTED", "DENIED"],
          "description": "PAC admission decision"
        },
        "correction_required": {
          "type": "boolean",
          "description": "Whether corrective action is required (for CORRECTIVE PACs)"
        }
      }
    },
    "block_content_runtime_activation": {
      "type": "object",
      "required": ["target", "mode"],
      "properties": {
        "target": {
          "type": "string",
          "description": "Target runtime (e.g., Benson Execution)"
        },
        "mode": {
          "type": "string",
          "enum": ["LAW-TIER", "POLICY-TIER", "OPERATIONAL-TIER"],
          "description": "Execution mode"
        },
        "mutation": {
          "type": "string",
          "enum": ["ALLOWED", "FORBIDDEN"],
          "description": "Whether mutations are permitted"
        }
      }
    },
    "block_content_goal_state": {
      "type": "object",
      "required": ["goals"],
      "properties": {
        "goals": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["id", "description"],
            "properties": {
              "id": { "type": "string" },
              "description": { "type": "string" },
              "measurable": { "type": "boolean" }
            }
          }
        }
      }
    },
    "block_content_invariants": {
      "type": "object",
      "required": ["invariants"],
      "properties": {
        "invariants": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "description"],
            "properties": {
              "id": {
                "type": "string",
                "pattern": "^INV-[A-Z]+-[0-9]{3}$",
                "description": "Invariant ID. Format: INV-{DOMAIN}-{SEQ}"
              },
              "description": { "type": "string" },
              "enforcement": {
                "type": "string",
                "enum": ["HARD", "SOFT"],
                "description": "HARD: violation = rejection. SOFT: violation = warning."
              }
            }
          }
        }
      }
    },
    "block_content_tasks": {
      "type": "object",
      "required": ["tasks"],
      "properties": {
        "tasks": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["id", "description"],
            "properties": {
              "id": { "type": "integer" },
              "description": { "type": "string" },
              "assignee": { "type": "string" },
              "dependencies": {
                "type": "array",
                "items": { "type": "integer" }
              }
            }
          }
        }
      }
    },
    "block_content_ledger_commit": {
      "type": "object",
      "required": ["hash", "committed_at"],
      "properties": {
        "hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "SHA-256 hash of committed PAC"
        },
        "committed_at": {
          "type": "string",
          "format": "date-time",
          "description": "Ledger commit timestamp"
        },
        "supersession_recorded": {
          "type": "boolean",
          "description": "Whether supersession was recorded (for CORRECTIVE PACs)"
        },
        "integrity_status": {
          "type": "string",
          "enum": ["VERIFIED", "PENDING"],
          "description": "Constitutional integrity status"
        }
      }
    }
  },
  "additionalProperties": false,
  "_meta": {
    "created_by": "PAC-JEFFREY-C05",
    "constitutional_reference": "OCC_CONSTITUTION_v1.0",
    "invariants_enforced": [
      "INV-PAC-010: Rejection reasons MUST be enumerable",
      "INV-PAC-011: Schema MUST be machine-verifiable",
      "INV-PAC-012: Operator feedback MUST be deterministic"
    ]
  }
}
