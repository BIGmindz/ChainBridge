name: Legacy Trading Bot CI/CD

# LEGACY WORKFLOW: This workflow is for historical trading bot functionality
# ChainBridge governance now uses .github/workflows/chainbridge-ci.yml
# This workflow only runs if trading bot files are modified

on:
  push:
    branches: [ main ]
    paths:
      - 'benson_rsi_bot.py'
      - 'live_trading_bot.py'
      - 'integrated_trading_system.py'
      - 'strategies/**'
      - 'modules/adaptive_weight_module/**'
      - 'modules/market_regime_module/**'
  pull_request:
    branches: [ main ]
    paths:
      - 'benson_rsi_bot.py'
      - 'live_trading_bot.py'
      - 'integrated_trading_system.py'
      - 'strategies/**'
      - 'modules/adaptive_weight_module/**'
      - 'modules/market_regime_module/**'

jobs:
  build-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.11'

      - name: Create virtual environment and install dependencies
        run: |
          python -m venv .venv
          source .venv/bin/activate
          pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          if [ -f requirements-dev.txt ]; then pip install -r requirements-dev.txt; fi

      - name: Run unit tests
        run: |
          source .venv/bin/activate
          # Only run if benson_rsi_bot.py exists (legacy trading bot)
          if [ -f benson_rsi_bot.py ]; then
            python benson_rsi_bot.py --test
          else
            echo "⚠️  Legacy trading bot file not found - skipping tests"
            echo "This workflow is for historical compatibility only"
          fi

  deploy:
    runs-on: ubuntu-latest
    needs: build-test
    if: github.ref == 'refs/heads/main'
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.11'

      - name: Create virtual environment and install dependencies
        run: |
          python -m venv .venv
          source .venv/bin/activate
          pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          if [ -f requirements-dev.txt ]; then pip install -r requirements-dev.txt; fi

      - name: Deploy Bot (example command)
        run: |
          source .venv/bin/activate
          # Only deploy if benson_rsi_bot.py exists (legacy trading bot)
          if [ -f benson_rsi_bot.py ]; then
            nohup python benson_rsi_bot.py > bot.log 2>&1 &
            echo "Bot deployed."
          else
            echo "⚠️  Legacy trading bot file not found - skipping deployment"
            echo "This workflow is for historical compatibility only"
          fi
