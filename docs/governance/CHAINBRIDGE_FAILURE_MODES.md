# ChainBridge Failure Modes Analysis

> **GOVERNANCE-CONTROLLED**
> Status: Active
> Version: 1.0.0
> PAC: PAC-GOV-FAIL-01
> Owner: ATLAS (GID-11)
> Approval Required: BENSON (GID-00)

---

## A. System Boundary Assumptions

### What ChainBridge Does

| Function | Description |
|----------|-------------|
| Supply chain orchestration | Coordinates logistics, shipment tracking, and milestone verification |
| Payment orchestration | Routes payments based on milestone completion and approval workflows |
| Agent governance | Enforces deterministic authorization via ACM, DRCP, and ALEX |
| Proofpack generation | Creates cryptographically-anchored audit bundles |
| Risk scoring (ChainIQ) | ML-based trust and risk assessments for counterparties/lanes |

### What ChainBridge Does Not Do

| Out of Scope | Reason |
|--------------|--------|
| Crypto trading / RSI strategies | Not aligned with mission; quarantined in `/archive` |
| Arbitrary LLM inference | Agents are bounded; no open-ended generation at runtime |
| Direct fund custody | ChainBridge orchestrates payments; it does not hold funds |
| Autonomous approvals | All `APPROVE` verbs require human authorization |
| Key custody | Customer KMS or external HSM; ChainBridge does not store secrets |

### Trusted Inputs

| Input | Trust Level | Validation |
|-------|-------------|------------|
| Human-issued `APPROVE` decisions | Trusted | Assumes authenticated human operator |
| ACM manifest (`AGENT_REGISTRY.json`) | Trusted | Loaded at boot; validated by `acm_loader.py` |
| Governance YAML/JSON configs | Trusted | Loaded at boot; immutable at runtime |
| Build manifest (`build/artifacts.json`) | Trusted | Generated by CI; verified at startup |

### Untrusted Inputs

| Input | Treatment |
|-------|-----------|
| Agent-proposed intents | Evaluated by ACM; default-deny |
| External LLM responses | Bounded by CDE; cannot escalate privileges |
| API payloads | Validated by gateway; rejected if malformed |
| Webhook callbacks | Validated against known sources; signed where applicable |

---

## B. Failure Mode Categories

### B1. Unauthorized Action

**Scenario:** An agent attempts an action outside its ACM grants.

| Aspect | Detail |
|--------|--------|
| Who tries | Any agent (GID-01 through GID-11), or forged GID |
| How it could happen | Crafted intent with verb/target outside ACM |
| Current mitigation | `acm_evaluator.py` enforces default-deny; unknown agents are denied |
| Test coverage | `tests/governance/test_acm_evaluator.py` |
| Blast radius | Local; intent rejected; no state mutation |
| Auditable | Yes — all evaluations logged via `EvaluationResult.to_audit_dict()` |

**Scenario:** Forged or malformed GID.

| Aspect | Detail |
|--------|--------|
| Current mitigation | `acm_loader.py` validates GID format; unknown GIDs denied |
| Denial reason | `UNKNOWN_AGENT` or `MALFORMED_GID` |
| Test coverage | `tests/governance/test_acm_loader.py` |

---

### B2. Governance Bypass

**Scenario:** Attempt to circumvent ACM or DRCP.

| Aspect | Detail |
|--------|--------|
| ACM bypass | Not possible at runtime; ACM is loaded at boot and frozen |
| DRCP bypass | Denied intents are routed to Diggi (GID-00); retry forbidden |
| Envelope tampering | CDE is immutable (`@dataclass(frozen=True)`); serialization is one-way |
| Test coverage | `tests/governance/test_drcp.py` (`TestAgentCannotRetryAfterDeny`) |

**Scenario:** Diggi attempts forbidden verbs.

| Aspect | Detail |
|--------|--------|
| Forbidden verbs | `EXECUTE`, `BLOCK`, `APPROVE` |
| Current mitigation | `DIGGI_FORBIDDEN_VERBS` in `diggi_envelope_handler.py` |
| Test coverage | `tests/governance/test_drcp.py` (`TestDiggyCannotExecute`, `TestDiggyCannotBlock`) |
| Denial reasons | `DIGGY_EXECUTE_FORBIDDEN`, `DIGGY_BLOCK_FORBIDDEN`, `DIGGY_APPROVE_FORBIDDEN` |

**Scenario:** Tool misuse at gateway.

| Aspect | Detail |
|--------|--------|
| Current mitigation | `gateway/tool_executor.py` validates tool binding before execution |
| Test coverage | `tests/gateway/test_tool_binding.py` |
| Blast radius | Local; tool call rejected; no side effects |

---

### B3. Human Error

**Scenario:** Misconfiguration of ACM or governance YAML.

| Aspect | Detail |
|--------|--------|
| How it could happen | Operator edits `AGENT_REGISTRY.json` incorrectly |
| Current mitigation | Boot checks (`core/governance/boot_checks.py`) validate manifests |
| Failure mode | Application refuses to start on invalid config |
| Recovery | Fix config; restart application |
| Test coverage | `tests/governance/test_boot_checks.py` |

**Scenario:** Incorrect human APPROVE.

| Aspect | Detail |
|--------|--------|
| How it could happen | Human approves an action that should not be approved |
| Current mitigation | None — human approvals are trusted by design |
| Blast radius | Depends on approved action; may propagate |
| Auditable | Yes — all approvals logged with timestamp and operator identity |
| Accepted risk | Human judgment is outside system enforcement |

**Scenario:** Operational misuse of CLI/scripts.

| Aspect | Detail |
|--------|--------|
| How it could happen | Operator runs destructive script in production |
| Current mitigation | Scope Guard blocks forbidden file execution |
| Test coverage | `tests/ci/test_scope_guard.py` |

---

### B4. LLM Misbehavior

**Scenario:** Hallucination in agent response.

| Aspect | Detail |
|--------|--------|
| How it could happen | External LLM returns fabricated data or intent |
| Current mitigation | CDE contract bounds all outputs; no capability escalation |
| Blast radius | Local; hallucinated intents evaluated by ACM; denied if outside grants |
| Auditable | Yes — CDE envelope preserves raw input and evaluation |

**Scenario:** Prompt drift / injection.

| Aspect | Detail |
|--------|--------|
| How it could happen | Malicious input attempts to override agent instructions |
| Current mitigation | Governance rules are injected at runtime but enforcement is at gateway |
| Blast radius | Local; gateway is authoritative, not prompt |
| Accepted risk | Prompt injection may cause poor suggestions; cannot escalate execution |

**Scenario:** External model misuse (ChainIQ).

| Aspect | Detail |
|--------|--------|
| How it could happen | ML model returns incorrect risk score |
| Current mitigation | Model integrity checked at startup (`scripts/check_model_integrity.py`) |
| Blast radius | May affect risk decisions; does not bypass payment approval |
| Auditable | Yes — scores logged; proofpack includes ChainIQ output |
| Accepted risk | Model accuracy is a data science concern, not a governance failure |

---

### B5. Supply Chain / Build Integrity

**Scenario:** Artifact tampering post-build.

| Aspect | Detail |
|--------|--------|
| How it could happen | Malicious actor modifies built artifacts after CI |
| Current mitigation | `scripts/ci/artifact_verifier.py` checks hashes at startup |
| Failure mode | `ArtifactIntegrityError` raised; application refuses to start |
| Test coverage | `tests/ci/test_artifact_integrity.py` |
| CI enforcement | `.github/workflows/artifact-integrity.yml` |

**Scenario:** CI compromise.

| Aspect | Detail |
|--------|--------|
| How it could happen | Attacker gains access to GitHub Actions |
| Current mitigation | Artifact manifest signed during build; verified at startup |
| Blast radius | High if undetected; startup verification is the last line |
| Accepted risk | CI security is outside ChainBridge runtime scope |

**Scenario:** Dependency drift.

| Aspect | Detail |
|--------|--------|
| How it could happen | Malicious or buggy dependency introduced |
| Current mitigation | `requirements.txt` pinned; CI runs against locked deps |
| Accepted risk | Dependency audit is a DevOps concern; runtime does not re-verify |

---

### B6. Data Integrity

**Scenario:** Partial failure during proofpack generation.

| Aspect | Detail |
|--------|--------|
| How it could happen | System crash mid-write |
| Current mitigation | Proofpack assembly is atomic; incomplete packs are not finalized |
| Blast radius | Local; pack either exists in full or not at all |
| Recovery | Re-trigger proofpack generation |

**Scenario:** Stale decisions.

| Aspect | Detail |
|--------|--------|
| How it could happen | ACM or config updated but not reloaded |
| Current mitigation | Config is loaded at boot; changes require restart |
| Accepted risk | Hot-reload is not supported; this is intentional |

**Scenario:** Replay attack on approved intents.

| Aspect | Detail |
|--------|--------|
| How it could happen | Attacker replays a previously-approved intent |
| Current mitigation | CDE includes `envelope_id` (UUID) and `timestamp` |
| Detection | Duplicate envelope IDs logged and rejected |
| Test coverage | `tests/gateway/test_decision_envelope.py` |

---

## C. Blast Radius Summary

| Failure Mode | Local Only | Propagates | Requires Human | Auditable |
|--------------|------------|------------|----------------|-----------|
| Unauthorized action | ✓ | — | — | ✓ |
| ACM bypass attempt | ✓ | — | — | ✓ |
| Diggi forbidden verb | ✓ | — | — | ✓ |
| Misconfiguration | ✓ | — | ✓ (fix config) | ✓ |
| Incorrect APPROVE | — | ✓ | ✓ | ✓ |
| LLM hallucination | ✓ | — | — | ✓ |
| Artifact tampering | ✓ | — | ✓ (rebuild) | ✓ |
| CI compromise | — | ✓ | ✓ (incident response) | Partial |
| Proofpack partial write | ✓ | — | — | ✓ |
| Replay attack | ✓ | — | — | ✓ |

---

## D. Existing Mitigations (Explicit References)

| Control | Location | Function |
|---------|----------|----------|
| ACM Evaluator | `core/governance/acm_evaluator.py` | Default-deny capability enforcement |
| ACM Loader | `core/governance/acm_loader.py` | GID validation, manifest loading |
| DRCP | `core/governance/drcp.py` | Denial routing, retry prevention |
| Diggi Envelope Handler | `core/governance/diggi_envelope_handler.py` | Bounded corrections, forbidden verb enforcement |
| CDE (Decision Envelope) | `gateway/decision_envelope.py` | Immutable, versioned response contract |
| Scope Guard | `scripts/scope_guard/check_repo_scope.py` | Forbidden file/import enforcement |
| Artifact Verifier | `scripts/ci/artifact_verifier.py` | Build hash verification at startup |
| Boot Checks | `core/governance/boot_checks.py` | Config validation at startup |
| Model Integrity | `scripts/check_model_integrity.py` | ChainIQ ML model hash verification |

### CI Enforcement

| Workflow | File | Gate |
|----------|------|------|
| Governance Check | `.github/workflows/governance_check.yml` | ACM, DRCP tests |
| Scope Guard | `.github/workflows/scope-guard.yml` | Forbidden file patterns |
| Artifact Integrity | `.github/workflows/artifact-integrity.yml` | Build manifest hashes |
| Gatekeeper Check | `.github/workflows/gatekeeper_check.yml` | Agent authorization |

---

## E. Known Gaps (Accepted Risks)

| Gap | Status | Rationale |
|-----|--------|-----------|
| Human APPROVE is trusted | Accepted | Human judgment is outside system scope |
| No hot-reload for governance configs | Accepted | Immutability is preferred over convenience |
| CI compromise detection is post-hoc | Accepted | Startup verification is the defense layer |
| Dependency drift is not runtime-checked | Accepted | Pinned deps + CI is the control |
| ML model accuracy | Accepted | Data science concern; scores are logged, not enforced |
| Prompt injection against LLM context | Accepted | Gateway is authoritative; prompt is advisory |

---

## F. Operational Response Expectations

### If: Unauthorized action is logged

| Step | Action |
|------|--------|
| 1 | Check `EvaluationResult` audit log for denial reason |
| 2 | Identify agent GID and intent |
| 3 | Verify ACM grants for that agent |
| 4 | If legitimate, update ACM; if malicious, investigate |

### If: Artifact integrity fails at startup

| Step | Action |
|------|--------|
| 1 | Application will not start |
| 2 | Check `build/artifacts.json` against last CI run |
| 3 | Rebuild artifacts from known-good commit |
| 4 | Investigate how files were modified |

### If: Incorrect APPROVE causes harm

| Step | Action |
|------|--------|
| 1 | Identify the approved intent from audit log |
| 2 | Trace downstream effects (payments, state changes) |
| 3 | Execute reversal if applicable |
| 4 | Review operator training / approval workflows |

### If: ChainIQ returns incorrect risk score

| Step | Action |
|------|--------|
| 1 | Check proofpack for ChainIQ output |
| 2 | Verify model hash against manifest |
| 3 | If model is valid, report to ML team for retraining |
| 4 | Score does not bypass payment approval; human has final say |

### Logs Available

| Log Source | Location | Contents |
|------------|----------|----------|
| ACM evaluations | Application stdout / structured log | All intent evaluations (allow/deny) |
| DRCP denials | Application structured log | Denial routing, correction proposals |
| CDE envelopes | Application structured log | Full envelope with correlation_id |
| Artifact verification | Application startup log | Pass/fail with file list |
| Proofpacks | `proofpacks/` directory | Complete audit bundles |

---

## Document Control

| Field | Value |
|-------|-------|
| Document ID | GOV-FAIL-01 |
| Version | 1.0.0 |
| Classification | Internal — Engineering |
| Review Cycle | Quarterly |
| Last Review | 2025-12-17 |
| Next Review | 2026-03-17 |

---

**END OF FAILURE MODES DOCUMENT**

```
STATUS: GOVERNANCE CONTROLLED
MODIFICATIONS REQUIRE BENSON (GID-00) APPROVAL
```
